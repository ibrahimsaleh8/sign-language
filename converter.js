const Keywords = [
  {
    keyword: "البيئة",
    variations: ["بيئة", "بيئه", "البيئه"],
    link: "https://files.catbox.moe/bxewen.mp4",
  },
  {
    keyword: "توثيق",
    variations: ["توثيق", "توثيق", "توثيق"],
    link: "https://files.catbox.moe/6u80wo.mp4",
  },
  {
    keyword: "مشاركة",
    variations: ["مشاركة", "مشاركه", "مشاركة"],
    link: "https://files.catbox.moe/zld6tl.mp4",
  },
  {
    keyword: "أسئلة سنوات سابقة",
    variations: ["أسئلة سنوات سابقة"],
    link: "https://files.catbox.moe/1a598n.mp4",
  },
  {
    keyword: "أعمار",
    variations: ["أعمار"],
    link: "https://files.catbox.moe/dftirn.mp4",
  },
  {
    keyword: "الامتحان صعب",
    variations: ["الامتحان صعب"],
    link: "https://files.catbox.moe/uqqi4j.mp4",
  },
  {
    keyword: "البيئة",
    variations: ["البيئة"],
    link: "https://files.catbox.moe/p2ti9e.mp4",
  },
  {
    keyword: "المحاضره فين",
    variations: ["المحاضره فين"],
    link: "https://files.catbox.moe/j92kiq.mp4",
  },
  {
    keyword: "المقاطعة",
    variations: ["المقاطعة"],
    link: "https://files.catbox.moe/i597u2.mp4",
  },
  {
    keyword: "برنامج إرشادي",
    variations: ["برنامج إرشادي"],
    link: "https://files.catbox.moe/uwlki3.mp4",
  },
  {
    keyword: "برنامج دراسي",
    variations: ["برنامج دراسي"],
    link: "https://files.catbox.moe/36oifb.mp4",
  },
  {
    keyword: "تحديات",
    variations: ["تحديات"],
    link: "https://files.catbox.moe/cg0s37.mp4",
  },
  {
    keyword: "تربيه فنيه",
    variations: ["تربيه فنيه"],
    link: "https://files.catbox.moe/hisz3p.mp4",
  },
  {
    keyword: "تصميم",
    variations: ["تصميم"],
    link: "https://files.catbox.moe/2uq8fx.mp4",
  },
  {
    keyword: "تعدد ثقافي",
    variations: ["تعدد ثقافي"],
    link: "https://files.catbox.moe/hebwic.mp4",
  },
  {
    keyword: "تفاهم دولي",
    variations: ["تفاهم دولي"],
    link: "https://files.catbox.moe/7uvvv0.mp4",
  },
  {
    keyword: "تقاليد",
    variations: ["تقاليد"],
    link: "https://files.catbox.moe/0g30jq.mp4",
  },
  {
    keyword: "تقييم",
    variations: ["تقييم"],
    link: "https://files.catbox.moe/e4o58z.mp4",
  },
  {
    keyword: "تنظيم",
    variations: ["تنظيم"],
    link: "https://files.catbox.moe/ac2fdb.mp4",
  },
  {
    keyword: "تنمية",
    variations: ["تنمية"],
    link: "https://files.catbox.moe/udrzg0.mp4",
  },
  {
    keyword: "جدول مذاكرة",
    variations: ["جدول مذاكرة"],
    link: "https://files.catbox.moe/xwkhc9.mp4",
  },
  {
    keyword: "جدول",
    variations: ["جدول"],
    link: "https://files.catbox.moe/7u26mi.mp4",
  },
  {
    keyword: "جودة",
    variations: ["جودة"],
    link: "https://files.catbox.moe/dz1gcr.mp4",
  },
  {
    keyword: "رياضه",
    variations: ["رياضه"],
    link: "https://files.catbox.moe/cv6eyh.mp4",
  },
  {
    keyword: "زوار",
    variations: ["زوار"],
    link: "https://files.catbox.moe/e553l6.mp4",
  },
  {
    keyword: "ساعات معتمدة",
    variations: ["ساعات معتمدة"],
    link: "https://files.catbox.moe/hljabc.mp4",
  },
  {
    keyword: "سياسات",
    variations: ["سياسات"],
    link: "https://files.catbox.moe/s50yuf.mp4",
  },
  {
    keyword: "صعوبات",
    variations: ["صعوبات"],
    link: "https://files.catbox.moe/6reovh.mp4",
  },
  {
    keyword: "عمل جزئي",
    variations: ["عمل جزئي"],
    link: "https://files.catbox.moe/iqq6aj.mp4",
  },
  {
    keyword: "غضبان",
    variations: ["غضبان"],
    link: "https://files.catbox.moe/43rg3d.mp4",
  },
  {
    keyword: "فائدة",
    variations: ["فائدة"],
    link: "https://files.catbox.moe/dj6nus.mp4",
  },
  {
    keyword: "فئات مختلفة",
    variations: ["فئات مختلفة"],
    link: "https://files.catbox.moe/az6ihq.mp4",
  },
  {
    keyword: "كمبيوتر",
    variations: ["كمبيوتر"],
    link: "https://files.catbox.moe/va2oq4.mp4",
  },
  {
    keyword: "متحف علمي",
    variations: ["متحف علمي"],
    link: "https://files.catbox.moe/tf35vk.mp4",
  },
  {
    keyword: "متحف فني",
    variations: ["متحف فني"],
    link: "https://files.catbox.moe/3dbpyi.mp4",
  },
  {
    keyword: "متحف",
    variations: ["متحف"],
    link: "https://files.catbox.moe/bpbtg2.mp4",
  },
  {
    keyword: "مجلة",
    variations: ["مجلة"],
    link: "https://files.catbox.moe/kpicnw.mp4",
  },
  {
    keyword: "محاكاه علمية",
    variations: ["محاكاه علمية"],
    link: "https://files.catbox.moe/gnp4xp.mp4",
  },
  {
    keyword: "مدارس",
    variations: ["مدارس"],
    link: "https://files.catbox.moe/9poq08.mp4",
  },
  {
    keyword: "مدرس مساعد",
    variations: ["مدرس مساعد"],
    link: "https://files.catbox.moe/fb1x7l.mp4",
  },
  {
    keyword: "مسابقه علمية",
    variations: ["مسابقه علمية"],
    link: "https://files.catbox.moe/uzm8v3.mp4",
  },
  {
    keyword: "مساعده ماليه",
    variations: ["مساعده ماليه"],
    link: "https://files.catbox.moe/sx2qqc.mp4",
  },
  {
    keyword: "مستقبل",
    variations: ["مستقبل"],
    link: "https://files.catbox.moe/o44r9e.mp4",
  },
  {
    keyword: "معرض",
    variations: ["معرض"],
    link: "https://files.catbox.moe/oyj9mi.mp4",
  },
  {
    keyword: "معيد جامعة",
    variations: ["معيد جامعة"],
    link: "https://files.catbox.moe/qhur1m.mp4",
  },
  {
    keyword: "مفيش فلوس",
    variations: ["مفيش فلوس"],
    link: "https://files.catbox.moe/vlyhhr.mp4",
  },
  {
    keyword: "مقرر علاجي",
    variations: ["مقرر علاجي"],
    link: "https://files.catbox.moe/afdr4z.mp4",
  },
  {
    keyword: "ملخص المنهج",
    variations: ["ملخص المنهج"],
    link: "https://files.catbox.moe/osio5e.mp4",
  },
  {
    keyword: "ملخص",
    variations: ["ملخص"],
    link: "https://files.catbox.moe/cvs8jl.mp4",
  },
  {
    keyword: "مناقشة علمية",
    variations: ["مناقشة علمية"],
    link: "https://files.catbox.moe/5uf9tm.mp4",
  },
  {
    keyword: "منهج",
    variations: ["منهج", "مناهج", "المنهج", "المناهج"],
    link: "https://files.catbox.moe/0xbm0i.mp4",
  },
  {
    keyword: "مواد عامة",
    variations: ["مواد عامة", "مادة عامة", "مواد عامه", "مادة عامه"],
    link: "https://files.catbox.moe/z1ubrc.mp4",
  },
  {
    keyword: "نشاط مدرسة",
    variations: ["نشاط مدرسة", "نشاط مدرسه", "أنشطة مدرسية", "نشاطات مدرسية"],
    link: "https://files.catbox.moe/eqkpa8.mp4",
  },
  {
    keyword: "هدف",
    variations: ["هدف", "أهداف", "الهدف", "الأهداف"],
    link: "https://files.catbox.moe/ukdoyw.mp4",
  },
  {
    keyword: "واجب",
    variations: ["واجب", "واجبات", "الواجب", "الواجبات"],
    link: "https://files.catbox.moe/example1.mp4",
  },
  {
    keyword: "اختبار",
    variations: [
      "اختبار",
      "اختبارات",
      "الاختبار",
      "الاختبارات",
      "امتحان",
      "امتحانات",
    ],
    link: "https://files.catbox.moe/example2.mp4",
  },
  {
    keyword: "محاضرة",
    variations: [
      "محاضرة",
      "محاضرات",
      "المحاضرة",
      "المحاضرات",
      "محاضره",
      "محاضرات",
    ],
    link: "https://files.catbox.moe/example3.mp4",
  },
];

// Get DOM elements
const btnConvert = document.querySelector("#convert_text");
const userText = document.querySelector("#textInput");
const signLanguageDisplay = document.getElementById("signLanguageDisplay");

// Function to normalize text for better matching
function normalizeText(text) {
  return text
    .trim()
    .toLowerCase() // Convert to lowercase for case-insensitive matching
    .replace(/[أإآا]/g, "ا") // Normalize Alef variations
    .replace(/ى/g, "ي") // Normalize Ya variations
    .replace(/ة/g, "ه") // Normalize Ta Marbuta
    .replace(/ؤ/g, "و") // Normalize Waw with Hamza
    .replace(/ئ/g, "ي") // Normalize Ya with Hamza
    .replace(/ء/g, "") // Remove Hamza
    .replace(/[ً-ْ]/g, "") // Remove diacritics
    .replace(/\s+/g, " ") // Normalize spaces
    .replace(/[،,]/g, "") // Remove commas
    .replace(/[؟?]/g, "") // Remove question marks
    .replace(/[!]/g, ""); // Remove exclamation marks
}

// Function to calculate similarity between two strings
function calculateSimilarity(str1, str2) {
  const s1 = normalizeText(str1);
  const s2 = normalizeText(str2);

  // If strings are identical after normalization
  if (s1 === s2) return 1;

  // If one string contains the other
  if (s1.includes(s2) || s2.includes(s1)) return 0.9;

  // Calculate word overlap
  const words1 = s1.split(" ");
  const words2 = s2.split(" ");
  const commonWords = words1.filter((word) => words2.includes(word));

  if (commonWords.length > 0) {
    return commonWords.length / Math.max(words1.length, words2.length);
  }

  return 0;
}

// Function to find matching keywords in text
function findMatchingKeywords(text) {
  const normalizedText = normalizeText(text);
  const words = normalizedText.split(" ");

  // First pass: exact matches
  let matches = Keywords.filter((item) => {
    const normalizedKeyword = normalizeText(item.keyword);
    return (
      normalizedText.includes(normalizedKeyword) ||
      item.variations.some((v) => normalizedText.includes(normalizeText(v)))
    );
  });

  // If no exact matches, try fuzzy matching
  if (matches.length === 0) {
    // Different thresholds for different types of matches
    const thresholds = {
      exact: 0.9, // For very close matches
      partial: 0.7, // For partial word matches
      fuzzy: 0.5, // For more lenient matches
    };

    matches = Keywords.filter((item) => {
      // Check main keyword
      const keywordSimilarity = calculateSimilarity(text, item.keyword);

      // Check if it's a very close match
      if (keywordSimilarity >= thresholds.exact) return true;

      // Check if it's a partial match
      if (keywordSimilarity >= thresholds.partial) {
        // Additional check for word boundaries
        const words = normalizedText.split(" ");
        const keywordWords = normalizeText(item.keyword).split(" ");
        const hasWordBoundaryMatch = keywordWords.some((kw) =>
          words.some((w) => w.includes(kw) || kw.includes(w))
        );
        if (hasWordBoundaryMatch) return true;
      }

      // Check variations with more lenient threshold
      return item.variations.some((variation) => {
        const variationSimilarity = calculateSimilarity(text, variation);
        return variationSimilarity >= thresholds.fuzzy;
      });
    });
  }

  // Sort matches by relevance (longer matches first)
  matches.sort((a, b) => {
    const aLength = a.keyword.length;
    const bLength = b.keyword.length;
    return bLength - aLength;
  });

  return matches;
}

// Function to create video element
function createVideoElement(videoUrl) {
  const video = document.createElement("video");
  video.controls = true;
  video.autoplay = true;
  video.muted = true;
  video.style.width = "100%";
  video.style.marginBottom = "10px";

  const source = document.createElement("source");
  source.src = videoUrl;
  source.type = "video/mp4";

  video.appendChild(source);
  return video;
}

// Convert button click handler
btnConvert.onclick = () => {
  const text = userText.value.trim();

  if (text === "") {
    alert("الرجاء إدخال نص للتحويل");
    return;
  }

  // Find matching keywords
  const matches = findMatchingKeywords(text);

  if (matches.length === 0) {
    alert("لم يتم العثور على كلمات مطابقة في النص");
    return;
  }

  // Clear previous content
  signLanguageDisplay.innerHTML = "";

  // Create and append video elements for each match
  matches.forEach((match) => {
    const videoElement = createVideoElement(match.link);
    signLanguageDisplay.appendChild(videoElement);
  });
};
